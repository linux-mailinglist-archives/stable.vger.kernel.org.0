Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id B4C354ED1AD
	for <lists+stable@lfdr.de>; Thu, 31 Mar 2022 04:25:12 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231391AbiCaCZD (ORCPT <rfc822;lists+stable@lfdr.de>);
        Wed, 30 Mar 2022 22:25:03 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:49764 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230097AbiCaCZC (ORCPT
        <rfc822;stable@vger.kernel.org>); Wed, 30 Mar 2022 22:25:02 -0400
Received: from mout.gmx.net (mout.gmx.net [212.227.17.22])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 220E21D2
        for <stable@vger.kernel.org>; Wed, 30 Mar 2022 19:23:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1648693381;
        bh=XCKunPRA91dViOcKjZM9Lh4MureewEhKyVXIxyv7deM=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date;
        b=Vz2qiif8F2H046hb3r9DyTN28dZwSj7/QiXtLgPjEI5W1pTED8pVrJbyoOvBWMPp2
         PyImQgiyRp1+jNFZODh5Rerde7P+ANEyb87tlFqq/2mklBJg4GC2p8sibUH4iodgct
         /YI7bq6NBXqNNHvPOgMHZYHMv0YNGRYJCdvt4fpw=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([46.223.2.105]) by mail.gmx.net (mrgmx104
 [212.227.17.168]) with ESMTPSA (Nemesis) id 1M3DNt-1naaTY1bMj-003axy; Thu, 31
 Mar 2022 04:23:01 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     gregkh@linuxfoundation.org
Cc:     LinoSanfilippo@gmx.de, jarkko@kernel.org, jgg@nvidia.com,
        jgg@ziepe.ca, stable@vger.kernel.org, stefanb@linux.ibm.com
Subject: [PATCH for-5.4] tpm: fix reference counting for struct tpm_chip
Date:   Thu, 31 Mar 2022 04:22:56 +0200
Message-Id: <20220331022256.1815-1-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.35.1
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:raV9r5ux+G+Co0SfyIEBKzX2wNU2FX9pl9sqH05Le36fp1zXWQb
 H14ppbBhTo+Z4cfBAxcLgRX6ZQLoPdiAIDRSA2xE89Kk0l2FX5KSMOFROCEhELwNjET7noE
 +4++hvQIoq25W4Mkgyv3bIjboCSc/WwV1wiwgD2/O/szWdWuiW0rjK5ilPtNG4pYHCXsB1T
 3OzYHu3AhMcpzd/f3LdyA==
X-UI-Out-Filterresults: notjunk:1;V03:K0:hDqlmburD74=:P1RBL4yep+KsFmbu03pYEJ
 xWl3I2eF6TjyQGV3ZuQfcVVTXoQOJlsmYQyMEi5qUWaMH8ORH9X+L0+WIXVk0zhlI1hLjtG/8
 /t5T62r/tALDj6TbJrrUZWG0QQaGU9R0/13aAw0UnNuDAJsuTYk7WkCwt+BqC7E0tDS0WONIJ
 hDB1hazsIEz7Cr+0r0HFWOCfR9+M6YokAqUnNqswR4Uy1V4dm6IdsjDMrevEgZJTLuzvxDS3c
 q+JydVv3xYft/5CLSWMO1Ua4WVCKVge47TFh+qkwFpaRUl8Bh9u4mQw9gUop26ObAB1JI9rSe
 +XoZ7fUD+o3MnILua/iDTlOTSRTF/qZOYRGf59/tp2w+xywZxgHJ1lDqseTz8HOinMsE/HF4f
 9wUggZ3CrrqKbnxM1RFjeBM2muFrIir0A1oZP2fg5+8AL5jBq8JbiMlRvvvLB/Pduv8y0r2H3
 SXVhrx5pWDXnJ7GC40W8jgTHZcqZgxJQks857iqc7ktJ+CXKY/w+cddCP3cZxdag8ty5wwpXO
 Zc6Mo2LKZUlwUf8eXgFRVxv38tTBOu6aOLEjDc75APepMVeACiqgIUfkTTiH4M6EPdP3bVn1B
 VjU0fbitoAABW02B8b7x0Dqe4fTlQ1UFMmG2wLF+9lTuM5jsyuwDj3TuxF+aWn+5EK+Dj2ru5
 PElifSCW35K0hWnDXnXzA74kVVFz1Rue71G8qBCsuJQvkaK9eSlWxhJEXhSwqwDv+x+wcsw+X
 vw9uQQgzQECZrFTcJAva/Bs6MAjVaYz2GvAYJqXBK0RmsubnKG4uc757TejO82Yb1De93keYn
 hcw1IgObK26UzH/Qcaud7wIxnmuEs7rzDT1S+ZjCZ0euQWY1XHtUwsD5t82R02HZjoAemhpTQ
 5UryIbwXNJO8hBNbMbc19BGVqDjrXO40QFtRlGjxwbp/M5xNLpJRB03kCAJnMGJBRj3J3Jc84
 hLpZ6dUBznd8uJiPWtPonhCut8jLIOVezD/vvA7aa+MZDmNw9OtvWwXCXUl/EGpy4aoRc023d
 k806xJThcGi7qXB51zNB7kHbmBQf9RjQds10ixtx4EjB4dCOhK1qKmwyvV+Wc3GWsv6pFpfmK
 GSFWgraHGPlJsS12HhADFpx4Jb89vQY/GHG
X-Spam-Status: No, score=2.5 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,FREEMAIL_FROM,MIME_BASE64_TEXT,RCVD_IN_DNSWL_LOW,
        RCVD_IN_MSPIKE_H4,RCVD_IN_MSPIKE_WL,RCVD_IN_SBL_CSS,SPF_HELO_NONE,
        SPF_PASS,T_SCC_BODY_TEXT_LINE autolearn=no autolearn_force=no
        version=3.4.6
X-Spam-Level: **
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

Y29tbWl0IDdlMDQzOGY4M2RjNzY5NDY1ZWU2NjNiYjVkY2Y4Y2MxNTQ5NDA3MTIgdXBzdHJlYW0u
CgpUaGUgZm9sbG93aW5nIHNlcXVlbmNlIG9mIG9wZXJhdGlvbnMgcmVzdWx0cyBpbiBhIHJlZmNv
dW50IHdhcm5pbmc6CgoxLiBPcGVuIGRldmljZSAvZGV2L3RwbXJtLgoyLiBSZW1vdmUgbW9kdWxl
IHRwbV90aXNfc3BpLgozLiBXcml0ZSBhIFRQTSBjb21tYW5kIHRvIHRoZSBmaWxlIGRlc2NyaXB0
b3Igb3BlbmVkIGF0IHN0ZXAgMS4KCi0tLS0tLS0tLS0tLVsgY3V0IGhlcmUgXS0tLS0tLS0tLS0t
LQpXQVJOSU5HOiBDUFU6IDMgUElEOiAxMTYxIGF0IGxpYi9yZWZjb3VudC5jOjI1IGtvYmplY3Rf
Z2V0KzB4YTAvMHhhNApyZWZjb3VudF90OiBhZGRpdGlvbiBvbiAwOyB1c2UtYWZ0ZXItZnJlZS4K
TW9kdWxlcyBsaW5rZWQgaW46IHRwbV90aXNfc3BpIHRwbV90aXNfY29yZSB0cG0gbWRpb19iY21f
dW5pbWFjIGJyY21mbWFjCnNoYTI1Nl9nZW5lcmljIGxpYnNoYTI1NiBzaGEyNTZfYXJtIGhjaV91
YXJ0IGJ0YmNtIGJsdWV0b290aCBjZmc4MDIxMSB2YzQKYnJjbXV0aWwgZWNkaF9nZW5lcmljIGVj
YyBzbmRfc29jX2NvcmUgY3JjMzJfYXJtX2NlIGxpYmFlcwpyYXNwYmVycnlwaV9od21vbiBhYzk3
X2J1cyBzbmRfcGNtX2RtYWVuZ2luZSBiY20yNzExX3RoZXJtYWwgc25kX3BjbQpzbmRfdGltZXIg
Z2VuZXQgc25kIHBoeV9nZW5lcmljIHNvdW5kY29yZSBbbGFzdCB1bmxvYWRlZDogc3BpX2JjbTI4
MzVdCkNQVTogMyBQSUQ6IDExNjEgQ29tbTogaG9sZF9vcGVuIE5vdCB0YWludGVkIDUuMTAuMGxz
LW1haW4tZGlydHkgIzIKSGFyZHdhcmUgbmFtZTogQkNNMjcxMQpbPGMwNDEwYzNjPl0gKHVud2lu
ZF9iYWNrdHJhY2UpIGZyb20gWzxjMDQwYjU4MD5dIChzaG93X3N0YWNrKzB4MTAvMHgxNCkKWzxj
MDQwYjU4MD5dIChzaG93X3N0YWNrKSBmcm9tIFs8YzEwOTIxNzQ+XSAoZHVtcF9zdGFjaysweGM0
LzB4ZDgpCls8YzEwOTIxNzQ+XSAoZHVtcF9zdGFjaykgZnJvbSBbPGMwNDQ1YTMwPl0gKF9fd2Fy
bisweDEwNC8weDEwOCkKWzxjMDQ0NWEzMD5dIChfX3dhcm4pIGZyb20gWzxjMDQ0NWFhOD5dICh3
YXJuX3Nsb3dwYXRoX2ZtdCsweDc0LzB4YjgpCls8YzA0NDVhYTg+XSAod2Fybl9zbG93cGF0aF9m
bXQpIGZyb20gWzxjMDg0MzVkMD5dIChrb2JqZWN0X2dldCsweGEwLzB4YTQpCls8YzA4NDM1ZDA+
XSAoa29iamVjdF9nZXQpIGZyb20gWzxiZjBhNzE1Yz5dICh0cG1fdHJ5X2dldF9vcHMrMHgxNC8w
eDU0IFt0cG1dKQpbPGJmMGE3MTVjPl0gKHRwbV90cnlfZ2V0X29wcyBbdHBtXSkgZnJvbSBbPGJm
MGE3ZDZjPl0gKHRwbV9jb21tb25fd3JpdGUrMHgzOC8weDYwIFt0cG1dKQpbPGJmMGE3ZDZjPl0g
KHRwbV9jb21tb25fd3JpdGUgW3RwbV0pIGZyb20gWzxjMDVhN2FjMD5dICh2ZnNfd3JpdGUrMHhj
NC8weDNjMCkKWzxjMDVhN2FjMD5dICh2ZnNfd3JpdGUpIGZyb20gWzxjMDVhN2VlND5dIChrc3lz
X3dyaXRlKzB4NTgvMHhjYykKWzxjMDVhN2VlND5dIChrc3lzX3dyaXRlKSBmcm9tIFs8YzA0MDAx
YTA+XSAocmV0X2Zhc3Rfc3lzY2FsbCsweDAvMHg0YykKRXhjZXB0aW9uIHN0YWNrKDB4YzIyNmJm
YTggdG8gMHhjMjI2YmZmMCkKYmZhMDogICAgICAgICAgICAgICAgICAgMDAwMDAwMDAgMDAwMTA1
YjQgMDAwMDAwMDMgYmVhZmU2NjQgMDAwMDAwMTQgMDAwMDAwMDAKYmZjMDogMDAwMDAwMDAgMDAw
MTA1YjQgMDAwMTAzZjggMDAwMDAwMDQgMDAwMDAwMDAgMDAwMDAwMDAgYjZmOWMwMDAgYmVhZmU2
ODQKYmZlMDogMDAwMDAwNmMgYmVhZmU2NDggMDAwMTA1NmMgYjZlYjY5NDQKLS0tWyBlbmQgdHJh
Y2UgZDRiODQwOWRlZjliOGIxZiBdLS0tCgpUaGUgcmVhc29uIGZvciB0aGlzIHdhcm5pbmcgaXMg
dGhlIGF0dGVtcHQgdG8gZ2V0IHRoZSBjaGlwLT5kZXYgcmVmZXJlbmNlCmluIHRwbV9jb21tb25f
d3JpdGUoKSBhbHRob3VnaCB0aGUgcmVmZXJlbmNlIGNvdW50ZXIgaXMgYWxyZWFkeSB6ZXJvLgoK
U2luY2UgY29tbWl0IDg5NzliMDJhYWYxZCAoInRwbTogRml4IHJlZmVyZW5jZSBjb3VudCB0byBt
YWluIGRldmljZSIpIHRoZQpleHRyYSByZWZlcmVuY2UgdXNlZCB0byBwcmV2ZW50IGEgcHJlbWF0
dXJlIHplcm8gY291bnRlciBpcyBuZXZlciB0YWtlbiwKYmVjYXVzZSB0aGUgcmVxdWlyZWQgVFBN
X0NISVBfRkxBR19UUE0yIGZsYWcgaXMgbmV2ZXIgc2V0LgoKRml4IHRoaXMgYnkgbW92aW5nIHRo
ZSBUUE0gMiBjaGFyYWN0ZXIgZGV2aWNlIGhhbmRsaW5nIGZyb20KdHBtX2NoaXBfYWxsb2MoKSB0
byB0cG1fYWRkX2NoYXJfZGV2aWNlKCkgd2hpY2ggaXMgY2FsbGVkIGF0IGEgbGF0ZXIgcG9pbnQK
aW4gdGltZSB3aGVuIHRoZSBmbGFnIGhhcyBiZWVuIHNldCBpbiBjYXNlIG9mIFRQTTIuCgpDb21t
aXQgZmRjOTE1ZjdmNzE5ICgidHBtOiBleHBvc2Ugc3BhY2VzIHZpYSBhIGRldmljZSBsaW5rIC9k
ZXYvdHBtcm08bj4iKQphbHJlYWR5IGludHJvZHVjZWQgZnVuY3Rpb24gdHBtX2RldnNfcmVsZWFz
ZSgpIHRvIHJlbGVhc2UgdGhlIGV4dHJhCnJlZmVyZW5jZSBidXQgZGlkIG5vdCBpbXBsZW1lbnQg
dGhlIHJlcXVpcmVkIHB1dCBvbiBjaGlwLT5kZXZzIHRoYXQgcmVzdWx0cwppbiB0aGUgY2FsbCBv
ZiB0aGlzIGZ1bmN0aW9uLgoKRml4IHRoaXMgYnkgcHV0dGluZyBjaGlwLT5kZXZzIGluIHRwbV9j
aGlwX3VucmVnaXN0ZXIoKS4KCkZpbmFsbHkgbW92ZSB0aGUgbmV3IGltcGxlbWVudGF0aW9uIGZv
ciB0aGUgVFBNIDIgaGFuZGxpbmcgaW50byBhIG5ldwpmdW5jdGlvbiB0byBhdm9pZCBtdWx0aXBs
ZSBjaGVja3MgZm9yIHRoZSBUUE1fQ0hJUF9GTEFHX1RQTTIgZmxhZyBpbiB0aGUKZ29vZCBjYXNl
IGFuZCBlcnJvciBjYXNlcy4KCkNjOiBzdGFibGVAdmdlci5rZXJuZWwub3JnCkZpeGVzOiBmZGM5
MTVmN2Y3MTkgKCJ0cG06IGV4cG9zZSBzcGFjZXMgdmlhIGEgZGV2aWNlIGxpbmsgL2Rldi90cG1y
bTxuPiIpCkZpeGVzOiA4OTc5YjAyYWFmMWQgKCJ0cG06IEZpeCByZWZlcmVuY2UgY291bnQgdG8g
bWFpbiBkZXZpY2UiKQpDby1kZXZlbG9wZWQtYnk6IEphc29uIEd1bnRob3JwZSA8amdnQHppZXBl
LmNhPgpTaWduZWQtb2ZmLWJ5OiBKYXNvbiBHdW50aG9ycGUgPGpnZ0B6aWVwZS5jYT4KU2lnbmVk
LW9mZi1ieTogTGlubyBTYW5maWxpcHBvIDxMaW5vU2FuZmlsaXBwb0BnbXguZGU+ClRlc3RlZC1i
eTogU3RlZmFuIEJlcmdlciA8c3RlZmFuYkBsaW51eC5pYm0uY29tPgpSZXZpZXdlZC1ieTogSmFz
b24gR3VudGhvcnBlIDxqZ2dAbnZpZGlhLmNvbT4KUmV2aWV3ZWQtYnk6IEphcmtrbyBTYWtraW5l
biA8amFya2tvQGtlcm5lbC5vcmc+ClNpZ25lZC1vZmYtYnk6IEphcmtrbyBTYWtraW5lbiA8amFy
a2tvQGtlcm5lbC5vcmc+Ci0tLQogZHJpdmVycy9jaGFyL3RwbS90cG0tY2hpcC5jICAgfCA0NiAr
KysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2NoYXIvdHBtL3RwbS5oICAgICAgICB8
ICAyICsrCiBkcml2ZXJzL2NoYXIvdHBtL3RwbTItc3BhY2UuYyB8IDY1ICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDc1IGluc2VydGlvbnMoKyks
IDM4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvY2hhci90cG0vdHBtLWNoaXAu
YyBiL2RyaXZlcnMvY2hhci90cG0vdHBtLWNoaXAuYwppbmRleCAxODM4MDM5YjAzMzMuLjE3ZmJk
N2Y3YTI5NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9jaGFyL3RwbS90cG0tY2hpcC5jCisrKyBiL2Ry
aXZlcnMvY2hhci90cG0vdHBtLWNoaXAuYwpAQCAtMjc0LDE0ICsyNzQsNiBAQCBzdGF0aWMgdm9p
ZCB0cG1fZGV2X3JlbGVhc2Uoc3RydWN0IGRldmljZSAqZGV2KQogCWtmcmVlKGNoaXApOwogfQog
Ci1zdGF0aWMgdm9pZCB0cG1fZGV2c19yZWxlYXNlKHN0cnVjdCBkZXZpY2UgKmRldikKLXsKLQlz
dHJ1Y3QgdHBtX2NoaXAgKmNoaXAgPSBjb250YWluZXJfb2YoZGV2LCBzdHJ1Y3QgdHBtX2NoaXAs
IGRldnMpOwotCi0JLyogcmVsZWFzZSB0aGUgbWFzdGVyIGRldmljZSByZWZlcmVuY2UgKi8KLQlw
dXRfZGV2aWNlKCZjaGlwLT5kZXYpOwotfQotCiAvKioKICAqIHRwbV9jbGFzc19zaHV0ZG93bigp
IC0gcHJlcGFyZSB0aGUgVFBNIGRldmljZSBmb3IgbG9zcyBvZiBwb3dlci4KICAqIEBkZXY6IGRl
dmljZSB0byB3aGljaCB0aGUgY2hpcCBpcyBhc3NvY2lhdGVkLgpAQCAtMzQ0LDcgKzMzNiw2IEBA
IHN0cnVjdCB0cG1fY2hpcCAqdHBtX2NoaXBfYWxsb2Moc3RydWN0IGRldmljZSAqcGRldiwKIAlj
aGlwLT5kZXZfbnVtID0gcmM7CiAKIAlkZXZpY2VfaW5pdGlhbGl6ZSgmY2hpcC0+ZGV2KTsKLQlk
ZXZpY2VfaW5pdGlhbGl6ZSgmY2hpcC0+ZGV2cyk7CiAKIAljaGlwLT5kZXYuY2xhc3MgPSB0cG1f
Y2xhc3M7CiAJY2hpcC0+ZGV2LmNsYXNzLT5zaHV0ZG93bl9wcmUgPSB0cG1fY2xhc3Nfc2h1dGRv
d247CkBAIC0zNTIsMjkgKzM0MywxMiBAQCBzdHJ1Y3QgdHBtX2NoaXAgKnRwbV9jaGlwX2FsbG9j
KHN0cnVjdCBkZXZpY2UgKnBkZXYsCiAJY2hpcC0+ZGV2LnBhcmVudCA9IHBkZXY7CiAJY2hpcC0+
ZGV2Lmdyb3VwcyA9IGNoaXAtPmdyb3VwczsKIAotCWNoaXAtPmRldnMucGFyZW50ID0gcGRldjsK
LQljaGlwLT5kZXZzLmNsYXNzID0gdHBtcm1fY2xhc3M7Ci0JY2hpcC0+ZGV2cy5yZWxlYXNlID0g
dHBtX2RldnNfcmVsZWFzZTsKLQkvKiBnZXQgZXh0cmEgcmVmZXJlbmNlIG9uIG1haW4gZGV2aWNl
IHRvIGhvbGQgb24KLQkgKiBiZWhhbGYgb2YgZGV2cy4gIFRoaXMgaG9sZHMgdGhlIGNoaXAgc3Ry
dWN0dXJlCi0JICogd2hpbGUgY2RldnMgaXMgaW4gdXNlLiAgVGhlIGNvcnJlc3BvbmRpbmcgcHV0
Ci0JICogaXMgaW4gdGhlIHRwbV9kZXZzX3JlbGVhc2UgKFRQTTIgb25seSkKLQkgKi8KLQlpZiAo
Y2hpcC0+ZmxhZ3MgJiBUUE1fQ0hJUF9GTEFHX1RQTTIpCi0JCWdldF9kZXZpY2UoJmNoaXAtPmRl
dik7Ci0KIAlpZiAoY2hpcC0+ZGV2X251bSA9PSAwKQogCQljaGlwLT5kZXYuZGV2dCA9IE1LREVW
KE1JU0NfTUFKT1IsIFRQTV9NSU5PUik7CiAJZWxzZQogCQljaGlwLT5kZXYuZGV2dCA9IE1LREVW
KE1BSk9SKHRwbV9kZXZ0KSwgY2hpcC0+ZGV2X251bSk7CiAKLQljaGlwLT5kZXZzLmRldnQgPQot
CQlNS0RFVihNQUpPUih0cG1fZGV2dCksIGNoaXAtPmRldl9udW0gKyBUUE1fTlVNX0RFVklDRVMp
OwotCiAJcmMgPSBkZXZfc2V0X25hbWUoJmNoaXAtPmRldiwgInRwbSVkIiwgY2hpcC0+ZGV2X251
bSk7Ci0JaWYgKHJjKQotCQlnb3RvIG91dDsKLQlyYyA9IGRldl9zZXRfbmFtZSgmY2hpcC0+ZGV2
cywgInRwbXJtJWQiLCBjaGlwLT5kZXZfbnVtKTsKIAlpZiAocmMpCiAJCWdvdG8gb3V0OwogCkBA
IC0zODIsOSArMzU2LDcgQEAgc3RydWN0IHRwbV9jaGlwICp0cG1fY2hpcF9hbGxvYyhzdHJ1Y3Qg
ZGV2aWNlICpwZGV2LAogCQljaGlwLT5mbGFncyB8PSBUUE1fQ0hJUF9GTEFHX1ZJUlRVQUw7CiAK
IAljZGV2X2luaXQoJmNoaXAtPmNkZXYsICZ0cG1fZm9wcyk7Ci0JY2Rldl9pbml0KCZjaGlwLT5j
ZGV2cywgJnRwbXJtX2ZvcHMpOwogCWNoaXAtPmNkZXYub3duZXIgPSBUSElTX01PRFVMRTsKLQlj
aGlwLT5jZGV2cy5vd25lciA9IFRISVNfTU9EVUxFOwogCiAJcmMgPSB0cG0yX2luaXRfc3BhY2Uo
JmNoaXAtPndvcmtfc3BhY2UsIFRQTTJfU1BBQ0VfQlVGRkVSX1NJWkUpOwogCWlmIChyYykgewpA
QCAtMzk2LDcgKzM2OCw2IEBAIHN0cnVjdCB0cG1fY2hpcCAqdHBtX2NoaXBfYWxsb2Moc3RydWN0
IGRldmljZSAqcGRldiwKIAlyZXR1cm4gY2hpcDsKIAogb3V0OgotCXB1dF9kZXZpY2UoJmNoaXAt
PmRldnMpOwogCXB1dF9kZXZpY2UoJmNoaXAtPmRldik7CiAJcmV0dXJuIEVSUl9QVFIocmMpOwog
fQpAQCAtNDQ1LDE0ICs0MTYsOSBAQCBzdGF0aWMgaW50IHRwbV9hZGRfY2hhcl9kZXZpY2Uoc3Ry
dWN0IHRwbV9jaGlwICpjaGlwKQogCX0KIAogCWlmIChjaGlwLT5mbGFncyAmIFRQTV9DSElQX0ZM
QUdfVFBNMikgewotCQlyYyA9IGNkZXZfZGV2aWNlX2FkZCgmY2hpcC0+Y2RldnMsICZjaGlwLT5k
ZXZzKTsKLQkJaWYgKHJjKSB7Ci0JCQlkZXZfZXJyKCZjaGlwLT5kZXZzLAotCQkJCSJ1bmFibGUg
dG8gY2Rldl9kZXZpY2VfYWRkKCkgJXMsIG1ham9yICVkLCBtaW5vciAlZCwgZXJyPSVkXG4iLAot
CQkJCWRldl9uYW1lKCZjaGlwLT5kZXZzKSwgTUFKT1IoY2hpcC0+ZGV2cy5kZXZ0KSwKLQkJCQlN
SU5PUihjaGlwLT5kZXZzLmRldnQpLCByYyk7Ci0JCQlyZXR1cm4gcmM7Ci0JCX0KKwkJcmMgPSB0
cG1fZGV2c19hZGQoY2hpcCk7CisJCWlmIChyYykKKwkJCWdvdG8gZXJyX2RlbF9jZGV2OwogCX0K
IAogCS8qIE1ha2UgdGhlIGNoaXAgYXZhaWxhYmxlLiAqLwpAQCAtNDYwLDYgKzQyNiwxMCBAQCBz
dGF0aWMgaW50IHRwbV9hZGRfY2hhcl9kZXZpY2Uoc3RydWN0IHRwbV9jaGlwICpjaGlwKQogCWlk
cl9yZXBsYWNlKCZkZXZfbnVtc19pZHIsIGNoaXAsIGNoaXAtPmRldl9udW0pOwogCW11dGV4X3Vu
bG9jaygmaWRyX2xvY2spOwogCisJcmV0dXJuIDA7CisKK2Vycl9kZWxfY2RldjoKKwljZGV2X2Rl
dmljZV9kZWwoJmNoaXAtPmNkZXYsICZjaGlwLT5kZXYpOwogCXJldHVybiByYzsKIH0KIApAQCAt
NjQxLDcgKzYxMSw3IEBAIHZvaWQgdHBtX2NoaXBfdW5yZWdpc3RlcihzdHJ1Y3QgdHBtX2NoaXAg
KmNoaXApCiAJCWh3cm5nX3VucmVnaXN0ZXIoJmNoaXAtPmh3cm5nKTsKIAl0cG1fYmlvc19sb2df
dGVhcmRvd24oY2hpcCk7CiAJaWYgKGNoaXAtPmZsYWdzICYgVFBNX0NISVBfRkxBR19UUE0yKQot
CQljZGV2X2RldmljZV9kZWwoJmNoaXAtPmNkZXZzLCAmY2hpcC0+ZGV2cyk7CisJCXRwbV9kZXZz
X3JlbW92ZShjaGlwKTsKIAl0cG1fZGVsX2NoYXJfZGV2aWNlKGNoaXApOwogfQogRVhQT1JUX1NZ
TUJPTF9HUEwodHBtX2NoaXBfdW5yZWdpc3Rlcik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIv
dHBtL3RwbS5oIGIvZHJpdmVycy9jaGFyL3RwbS90cG0uaAppbmRleCAzN2YwMTA0MjFhMzYuLjU4
MzEyMDYyZDQzNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9jaGFyL3RwbS90cG0uaAorKysgYi9kcml2
ZXJzL2NoYXIvdHBtL3RwbS5oCkBAIC00NjYsNiArNDY2LDggQEAgaW50IHRwbTJfcHJlcGFyZV9z
cGFjZShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXAsIHN0cnVjdCB0cG1fc3BhY2UgKnNwYWNlLCB1OCAq
Y21kLAogCQkgICAgICAgc2l6ZV90IGNtZHNpeik7CiBpbnQgdHBtMl9jb21taXRfc3BhY2Uoc3Ry
dWN0IHRwbV9jaGlwICpjaGlwLCBzdHJ1Y3QgdHBtX3NwYWNlICpzcGFjZSwgdm9pZCAqYnVmLAog
CQkgICAgICBzaXplX3QgKmJ1ZnNpeik7CitpbnQgdHBtX2RldnNfYWRkKHN0cnVjdCB0cG1fY2hp
cCAqY2hpcCk7Cit2b2lkIHRwbV9kZXZzX3JlbW92ZShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApOwog
CiB2b2lkIHRwbV9iaW9zX2xvZ19zZXR1cChzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApOwogdm9pZCB0
cG1fYmlvc19sb2dfdGVhcmRvd24oc3RydWN0IHRwbV9jaGlwICpjaGlwKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvY2hhci90cG0vdHBtMi1zcGFjZS5jIGIvZHJpdmVycy9jaGFyL3RwbS90cG0yLXNw
YWNlLmMKaW5kZXggOTdlOTE2ODU2Y2YzLi4yNjVlYzcyYjFkODEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvY2hhci90cG0vdHBtMi1zcGFjZS5jCisrKyBiL2RyaXZlcnMvY2hhci90cG0vdHBtMi1zcGFj
ZS5jCkBAIC01NzQsMyArNTc0LDY4IEBAIGludCB0cG0yX2NvbW1pdF9zcGFjZShzdHJ1Y3QgdHBt
X2NoaXAgKmNoaXAsIHN0cnVjdCB0cG1fc3BhY2UgKnNwYWNlLAogCWRldl9lcnIoJmNoaXAtPmRl
diwgIiVzOiBlcnJvciAlZFxuIiwgX19mdW5jX18sIHJjKTsKIAlyZXR1cm4gcmM7CiB9CisKKy8q
CisgKiBQdXQgdGhlIHJlZmVyZW5jZSB0byB0aGUgbWFpbiBkZXZpY2UuCisgKi8KK3N0YXRpYyB2
b2lkIHRwbV9kZXZzX3JlbGVhc2Uoc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0cnVjdCB0cG1f
Y2hpcCAqY2hpcCA9IGNvbnRhaW5lcl9vZihkZXYsIHN0cnVjdCB0cG1fY2hpcCwgZGV2cyk7CisK
KwkvKiByZWxlYXNlIHRoZSBtYXN0ZXIgZGV2aWNlIHJlZmVyZW5jZSAqLworCXB1dF9kZXZpY2Uo
JmNoaXAtPmRldik7Cit9CisKKy8qCisgKiBSZW1vdmUgdGhlIGRldmljZSBmaWxlIGZvciBleHBv
c2VkIFRQTSBzcGFjZXMgYW5kIHJlbGVhc2UgdGhlIGRldmljZQorICogcmVmZXJlbmNlLiBUaGlz
IG1heSBhbHNvIHJlbGVhc2UgdGhlIHJlZmVyZW5jZSB0byB0aGUgbWFzdGVyIGRldmljZS4KKyAq
Lwordm9pZCB0cG1fZGV2c19yZW1vdmUoc3RydWN0IHRwbV9jaGlwICpjaGlwKQoreworCWNkZXZf
ZGV2aWNlX2RlbCgmY2hpcC0+Y2RldnMsICZjaGlwLT5kZXZzKTsKKwlwdXRfZGV2aWNlKCZjaGlw
LT5kZXZzKTsKK30KKworLyoKKyAqIEFkZCBhIGRldmljZSBmaWxlIHRvIGV4cG9zZSBUUE0gc3Bh
Y2VzLiBBbHNvIHRha2UgYSByZWZlcmVuY2UgdG8gdGhlCisgKiBtYWluIGRldmljZS4KKyAqLwor
aW50IHRwbV9kZXZzX2FkZChzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCit7CisJaW50IHJjOworCisJ
ZGV2aWNlX2luaXRpYWxpemUoJmNoaXAtPmRldnMpOworCWNoaXAtPmRldnMucGFyZW50ID0gY2hp
cC0+ZGV2LnBhcmVudDsKKwljaGlwLT5kZXZzLmNsYXNzID0gdHBtcm1fY2xhc3M7CisKKwkvKgor
CSAqIEdldCBleHRyYSByZWZlcmVuY2Ugb24gbWFpbiBkZXZpY2UgdG8gaG9sZCBvbiBiZWhhbGYg
b2YgZGV2cy4KKwkgKiBUaGlzIGhvbGRzIHRoZSBjaGlwIHN0cnVjdHVyZSB3aGlsZSBjZGV2cyBp
cyBpbiB1c2UuIFRoZQorCSAqIGNvcnJlc3BvbmRpbmcgcHV0IGlzIGluIHRoZSB0cG1fZGV2c19y
ZWxlYXNlLgorCSAqLworCWdldF9kZXZpY2UoJmNoaXAtPmRldik7CisJY2hpcC0+ZGV2cy5yZWxl
YXNlID0gdHBtX2RldnNfcmVsZWFzZTsKKwljaGlwLT5kZXZzLmRldnQgPSBNS0RFVihNQUpPUih0
cG1fZGV2dCksIGNoaXAtPmRldl9udW0gKyBUUE1fTlVNX0RFVklDRVMpOworCWNkZXZfaW5pdCgm
Y2hpcC0+Y2RldnMsICZ0cG1ybV9mb3BzKTsKKwljaGlwLT5jZGV2cy5vd25lciA9IFRISVNfTU9E
VUxFOworCisJcmMgPSBkZXZfc2V0X25hbWUoJmNoaXAtPmRldnMsICJ0cG1ybSVkIiwgY2hpcC0+
ZGV2X251bSk7CisJaWYgKHJjKQorCQlnb3RvIGVycl9wdXRfZGV2czsKKworCXJjID0gY2Rldl9k
ZXZpY2VfYWRkKCZjaGlwLT5jZGV2cywgJmNoaXAtPmRldnMpOworCWlmIChyYykgeworCQlkZXZf
ZXJyKCZjaGlwLT5kZXZzLAorCQkJInVuYWJsZSB0byBjZGV2X2RldmljZV9hZGQoKSAlcywgbWFq
b3IgJWQsIG1pbm9yICVkLCBlcnI9JWRcbiIsCisJCQlkZXZfbmFtZSgmY2hpcC0+ZGV2cyksIE1B
Sk9SKGNoaXAtPmRldnMuZGV2dCksCisJCQlNSU5PUihjaGlwLT5kZXZzLmRldnQpLCByYyk7CisJ
CWdvdG8gZXJyX3B1dF9kZXZzOworCX0KKworCXJldHVybiAwOworCitlcnJfcHV0X2RldnM6CisJ
cHV0X2RldmljZSgmY2hpcC0+ZGV2cyk7CisKKwlyZXR1cm4gcmM7Cit9Ci0tIAoyLjM1LjEKCg==
