Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 8393423AA99
	for <lists+stable@lfdr.de>; Mon,  3 Aug 2020 18:37:03 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726130AbgHCQgz (ORCPT <rfc822;lists+stable@lfdr.de>);
        Mon, 3 Aug 2020 12:36:55 -0400
Received: from mx2.suse.de ([195.135.220.15]:35276 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725945AbgHCQgz (ORCPT <rfc822;stable@vger.kernel.org>);
        Mon, 3 Aug 2020 12:36:55 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
        by mx2.suse.de (Postfix) with ESMTP id A6474AC52;
        Mon,  3 Aug 2020 16:37:09 +0000 (UTC)
Date:   Mon, 03 Aug 2020 18:36:54 +0200
Message-ID: <s5hwo2f3cux.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Cc:     Hui Wang <hui.wang@canonical.com>, alsa-devel@alsa-project.org,
        stable@vger.kernel.org
Subject: Re: [PATCH] Revert "ALSA: hda: call runtime_allow() for all hda controllers"
In-Reply-To: <0db4f5fe-7895-2d00-8ce3-96f1245000ab@linux.intel.com>
References: <20200803064638.6139-1-hui.wang@canonical.com>
        <0db4f5fe-7895-2d00-8ce3-96f1245000ab@linux.intel.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: stable-owner@vger.kernel.org
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

On Mon, 03 Aug 2020 17:27:12 +0200,
Pierre-Louis Bossart wrote:
> 
> 
> 
> On 8/3/20 1:46 AM, Hui Wang wrote:
> > This reverts commit 9a6418487b56 ("ALSA: hda: call runtime_allow()
> > for all hda controllers").
> >
> > The reverted patch already introduced some regressions on some
> > machines:
> >   - on gemini-lake machines, the error of "azx_get_response timeout"
> >     happens in the hda driver.
> >   - on the machines with alc662 codec, the audio jack detection doesn't
> >     work anymore.
> >
> > BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=208511
> > Cc: <stable@vger.kernel.org>
> > Signed-off-by: Hui Wang <hui.wang@canonical.com>
> > ---
> >   sound/pci/hda/hda_intel.c | 1 -
> >   1 file changed, 1 deletion(-)
> >
> > diff --git a/sound/pci/hda/hda_intel.c b/sound/pci/hda/hda_intel.c
> > index e699873c8293..e34a4d5d047c 100644
> > --- a/sound/pci/hda/hda_intel.c
> > +++ b/sound/pci/hda/hda_intel.c
> > @@ -2352,7 +2352,6 @@ static int azx_probe_continue(struct azx *chip)
> >     	if (azx_has_pm_runtime(chip)) {
> >   		pm_runtime_use_autosuspend(&pci->dev);
> > -		pm_runtime_allow(&pci->dev);
> >   		pm_runtime_put_autosuspend(&pci->dev);
> >   	}
> 
> Do I get this right that this permanently disables pm_runtime on all
> Intel HDaudio controllers?

It just drops the unconditional enablement of runtime PM.
It can be enabled via sysfs, and that's the old default (let admin
enabling it via udev or whatever).


thanks,

Takashi
