Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 1DD47138690
	for <lists+stable@lfdr.de>; Sun, 12 Jan 2020 14:03:48 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1732860AbgALNDr (ORCPT <rfc822;lists+stable@lfdr.de>);
        Sun, 12 Jan 2020 08:03:47 -0500
Received: from mail-ed1-f65.google.com ([209.85.208.65]:38778 "EHLO
        mail-ed1-f65.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1732859AbgALNDq (ORCPT
        <rfc822;stable@vger.kernel.org>); Sun, 12 Jan 2020 08:03:46 -0500
Received: by mail-ed1-f65.google.com with SMTP id i16so6018711edr.5;
        Sun, 12 Jan 2020 05:03:45 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :cc;
        bh=LPfprFmHx12pshQR3Bs7ESSVF/5so2k7WxJXYYduZPg=;
        b=vPTZxsUIA5eLyW3Lcq4lKc8uJM113sfAzCegClUwRRstF49nXwf9i+pUZe9xI15OUq
         0VsfeOKayn4jTTysh3cV2xUs9/petOgBBrblaBVCBkFgl5VdJJKmEVIKJ54bRFCJelbF
         if4aJU8gyTPRJDv7eYCHL5SVfY2NCpnOnxacO5d0r7zyGTxgYaYWJiq9UWNOKfXyMzpw
         ZGf20qJXPJ1qSSNVP+prepth9hocWLgIK8LAZNsIhbZRQecnvhXQwE4niViUBkQpwxYr
         6u9PRL2oT25mUAhuYI2ok4iPzJPxo5K8YAyOKK2vdgLCLLeHWlHuUa1IYHy/pKrJLZy2
         F5FQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:in-reply-to:references:from:date
         :message-id:subject:to:cc;
        bh=LPfprFmHx12pshQR3Bs7ESSVF/5so2k7WxJXYYduZPg=;
        b=LUaEVQnuF4QuzrVxRkcYrcG7xWCCco+WHQ1b/k5JE9gUCdowlMYeWgnwty1TTxdGFL
         FY7xMtO1YPBzQ0BdozqqacUIlnZJLUXoX0htzXuLuhPU4wOOcDYQMZG8BfxfnvEVx1XO
         P2PyziEduDFeGdA1/BXWCMixFpRL1uk8cFAtqKRqHdpQFrWPi80uTjAmEgPKmeNc4rkA
         6U1u8w/LFh6emoDpDRH2/OU0eOHeqKuU+KuCcpJU7spkWKZUyLrOJcZglLWsnCNClLzv
         rbckirMG+Vj2l9nGOJbD67i8ZNWPdLGmZpEQ/3KoQ1jhAnKVTL/QuMk2A2t6kVjJj5EA
         Abyw==
X-Gm-Message-State: APjAAAXXTckdPUB3gxCWfTPayrqXz5T/wke17UPMM0oGVepkdtlpcTt0
        9xSgV/HO3wLxRK+amtU+oB+e/M/op7CwU0qCUCQ=
X-Google-Smtp-Source: APXvYqwlUMYr23tNBhpBcFuIK3B0WALvP6qMmcpZAbLqHBPTW6q94EPoYE3AFf8nuwJ/cEOhHznauMgUuIGU9j1GXg4=
X-Received: by 2002:a05:6402:31b5:: with SMTP id dj21mr9677434edb.308.1578834225028;
 Sun, 12 Jan 2020 05:03:45 -0800 (PST)
MIME-Version: 1.0
Received: by 2002:a05:6402:1c11:0:0:0:0 with HTTP; Sun, 12 Jan 2020 05:03:44
 -0800 (PST)
In-Reply-To: <CACMCwJK-2DHZDA_F5Z3wsEUEKJSc3uOwwPD4HRoYGW7A+kA75w@mail.gmail.com>
References: <CACMCwJK-2DHZDA_F5Z3wsEUEKJSc3uOwwPD4HRoYGW7A+kA75w@mail.gmail.com>
From:   Jari Ruusu <jari.ruusu@gmail.com>
Date:   Sun, 12 Jan 2020 15:03:44 +0200
Message-ID: <CACMCwJ+FE8yD10VF07ci6tTqiBA8aBejKQT0EwyayQQOrLGUKQ@mail.gmail.com>
Subject: Re: Fix built-in early-load Intel microcode alignment
To:     Borislav Petkov <bp@alien8.de>, Fenghua Yu <fenghua.yu@intel.com>,
        Luis Chamberlain <mcgrof@kernel.org>,
        Linus Torvalds <torvalds@linux-foundation.org>
Cc:     linux-kernel@vger.kernel.org, stable@vger.kernel.org
Content-Type: text/plain; charset="UTF-8"
Sender: stable-owner@vger.kernel.org
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

On 1/12/20, Jari Ruusu <jari.ruusu@gmail.com> wrote:
> Intel Software Developer's Manual, volume 3, chapter 9.11.6 says:
> "Note that the microcode update must be aligned on a 16-byte
> boundary and the size of the microcode update must be 1-KByte
> granular"
>
> When early-load Intel microcode is loaded from initramfs,
> userspace tool 'iucode_tool' has already 16-byte aligned those
> microcode bits in that initramfs image. Image that was created
> something like this:
>
>  iucode_tool --write-earlyfw=FOO.cpio microcode-files...
>
> However, when early-load Intel microcode is loaded from built-in
> firmware BLOB using CONFIG_EXTRA_FIRMWARE= kernel config option,
> that 16-byte alignment is not guaranteed.
>
> Fix this by forcing all built-in firmware BLOBs to 16-byte
> alignment.

Backport of "Fix built-in early-load Intel microcode alignment"
for linux-4.19 and older stable kernels.

Signed-off-by: Jari Ruusu <jari.ruusu@gmail.com>

--- a/firmware/Makefile
+++ b/firmware/Makefile
@@ -19,7 +19,7 @@
 		  PROGBITS=$(if $(CONFIG_ARM),%,@)progbits;		     \
 		  echo "/* Generated by firmware/Makefile */"		> $@;\
 		  echo "    .section .rodata"				>>$@;\
-		  echo "    .p2align $${ASM_ALIGN}"			>>$@;\
+		  echo "    .p2align 4"					>>$@;\
 		  echo "_fw_$${FWSTR}_bin:"				>>$@;\
 		  echo "    .incbin \"$(2)\""				>>$@;\
 		  echo "_fw_end:"					>>$@;\

-- 
Jari Ruusu  4096R/8132F189 12D6 4C3A DCDA 0AA4 27BD  ACDF F073 3C80 8132 F189
