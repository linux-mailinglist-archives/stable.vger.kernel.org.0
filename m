Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 705F82E1945
	for <lists+stable@lfdr.de>; Wed, 23 Dec 2020 08:11:59 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727114AbgLWHKY (ORCPT <rfc822;lists+stable@lfdr.de>);
        Wed, 23 Dec 2020 02:10:24 -0500
Received: from mx2.suse.de ([195.135.220.15]:41480 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1727046AbgLWHKX (ORCPT <rfc822;stable@vger.kernel.org>);
        Wed, 23 Dec 2020 02:10:23 -0500
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
        by mx2.suse.de (Postfix) with ESMTP id E04D8ACC4;
        Wed, 23 Dec 2020 07:09:41 +0000 (UTC)
Date:   Wed, 23 Dec 2020 08:09:41 +0100
Message-ID: <s5h4kkddmmi.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Sasha Levin <sashal@kernel.org>
Cc:     linux-kernel@vger.kernel.org, stable@vger.kernel.org,
        Dylan Robinson <dylan_robinson@motu.com>,
        Keith Milner <kamilner@superlative.org>,
        alsa-devel@alsa-project.org
Subject: Re: [PATCH AUTOSEL 5.4 057/130] ALSA: usb-audio: Check valid altsetting at parsing rates for UAC2/3
In-Reply-To: <20201223021813.2791612-57-sashal@kernel.org>
References: <20201223021813.2791612-1-sashal@kernel.org>
        <20201223021813.2791612-57-sashal@kernel.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

On Wed, 23 Dec 2020 03:17:00 +0100,
Sasha Levin wrote:
> 
> From: Takashi Iwai <tiwai@suse.de>
> 
> [ Upstream commit 93db51d06b32227319dae2ac289029ccf1b33181 ]
> 
> The current driver code assumes blindly that all found sample rates for
> the same endpoint from the UAC2 and UAC3 descriptors can be used no
> matter which altsetting, but actually this was wrong: some devices
> accept only limited sample rates in each altsetting.  For determining
> which altsetting supports which rate, we need to verify each sample rate
> and check the validity via UAC2_AS_VAL_ALT_SETTINGS.  This control
> reports back the available altsettings as a bitmap.
> 
> This patch implements the missing piece above, the verification and
> reconstructs the sample rate tables based on the result.
> 
> An open question is how to deal with the altsettings that ended up
> with no valid sample rates after verification.  At least, there is a
> device that showed this problem although the sample rates did work in
> the later usage (see bug link).  For now, we accept such an altset as
> is, assuming that it's a firmware bug.
> 
> Reported-by: Dylan Robinson <dylan_robinson@motu.com>
> Tested-by: Keith Milner <kamilner@superlative.org>
> Tested-by: Dylan Robinson <dylan_robinson@motu.com>
> BugLink: https://bugzilla.suse.com/show_bug.cgi?id=1178203
> Link: https://lore.kernel.org/r/20201123085347.19667-4-tiwai@suse.de
> Signed-off-by: Takashi Iwai <tiwai@suse.de>
> Signed-off-by: Sasha Levin <sashal@kernel.org>

Please drop this for 5.4 or older.  At least this caused some problem
on 5.3 kernel that confused USB core by some reason while it works
fine with the recent upstream.


thanks,

Takashi
