Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 2A6DA29079
	for <lists+stable@lfdr.de>; Fri, 24 May 2019 07:43:45 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1731824AbfEXFno (ORCPT <rfc822;lists+stable@lfdr.de>);
        Fri, 24 May 2019 01:43:44 -0400
Received: from mx2.suse.de ([195.135.220.15]:50776 "EHLO mx1.suse.de"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1725890AbfEXFno (ORCPT <rfc822;stable@vger.kernel.org>);
        Fri, 24 May 2019 01:43:44 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
        by mx1.suse.de (Postfix) with ESMTP id 06D74AEA1;
        Fri, 24 May 2019 05:43:42 +0000 (UTC)
Date:   Fri, 24 May 2019 07:43:42 +0200
Message-ID: <s5h7eagflv5.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Jian-Hong Pan <jian-hong@endlessm.com>
Cc:     stable@vger.kernel.org, linux@endlessm.com
Subject: Re: [PATCH] Revert "ALSA: hda - Enforces runtime_resume after S3 and S4 for each codec"
In-Reply-To: <20190524051015.4680-1-jian-hong@endlessm.com>
References: <20190524051015.4680-1-jian-hong@endlessm.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: stable-owner@vger.kernel.org
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

On Fri, 24 May 2019 07:10:17 +0200,
Jian-Hong Pan wrote:
> 
> We have an ASUS E406MA laptop equipped with Intel N5000 CPU.  After
> system suspend & resume, the audio playback does not work anymore. The
> device for sound output is listed as a headphone device.  Plugging in
> headphones no sound is audible neither.
> 
> Here are the error messages after resume:
> 
> [  184.525681] snd_hda_intel 0000:00:0e.0: azx_get_response timeout, switching to polling mode: last cmd=0x20bf8100
> [  185.528682] snd_hda_intel 0000:00:0e.0: No response from codec, disabling MSI: last cmd=0x20bf8100
> [  186.532683] snd_hda_intel 0000:00:0e.0: azx_get_response timeout, switching to single_cmd mode: last cmd=0x20bf8100
> [  186.736838] snd_hda_codec_realtek hdaudioC0D0: Unable to sync register 0x2b8000. -5
> [  186.738742] snd_hda_codec_realtek hdaudioC0D0: Unable to sync register 0x2b8000. -5
> [  186.767080] snd_hda_codec_hdmi hdaudioC0D2: Unable to sync register 0x2f0d00. -5
> 
> After bisect, we found reverting the commit b5a236c175b0 "ALSA: hda -
> Enforces runtime_resume after S3 and S4 for each codec" can solve this
> issue on Linux stable 5.0.x series.
> 
> This reverts commit a57af6d07512716b78f1a32d9426bcdf6aafc50c.
> 
> Buglink: https://bugzilla.kernel.org/show_bug.cgi?id=203623
> Fixes: a57af6d07512 ("ALSA: hda - Enforces runtime_resume after S3 and S4 for each codec")
> Cc: <stable@vger.kernel.org> # 5.0.x
> Signed-off-by: Jian-Hong Pan <jian-hong@endlessm.com>

I thought this revert isn't needed if the i915 GLK fix is applied?

You must hit the very same problem even after reverting this when the
machine goes to suspend while playing a stream.  So the revert is no
proper fix at all.


thanks,

Takashi
