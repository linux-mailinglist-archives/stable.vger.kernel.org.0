Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id EFB332401FF
	for <lists+stable@lfdr.de>; Mon, 10 Aug 2020 08:30:26 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725808AbgHJGaZ (ORCPT <rfc822;lists+stable@lfdr.de>);
        Mon, 10 Aug 2020 02:30:25 -0400
Received: from mx2.suse.de ([195.135.220.15]:41180 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725774AbgHJGaZ (ORCPT <rfc822;stable@vger.kernel.org>);
        Mon, 10 Aug 2020 02:30:25 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
        by mx2.suse.de (Postfix) with ESMTP id 8BE9FAC3F;
        Mon, 10 Aug 2020 06:30:44 +0000 (UTC)
Date:   Mon, 10 Aug 2020 08:30:24 +0200
Message-ID: <s5hd03z6min.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Hui Wang <hui.wang@canonical.com>
Cc:     alsa-devel@alsa-project.org, stable@vger.kernel.org
Subject: Re: [PATCH] ALSA: hda - fix the micmute led status for Lenovo ThinkCentre AIO
In-Reply-To: <20200810021659.7429-1-hui.wang@canonical.com>
References: <20200810021659.7429-1-hui.wang@canonical.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: stable-owner@vger.kernel.org
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

On Mon, 10 Aug 2020 04:16:59 +0200,
Hui Wang wrote:
> 
> After installing the Ubuntu Linux, the micmute led status is not
> correct. Users expect that the led is on if the capture is disabled,
> but with the current kernel, the led is off with the capture disabled.
> 
> We tried the old linux kernel like linux-4.15, there is no this issue.
> It looks like we introduced this issue when switching to the led_cdev.

The behavior can be controlled via "Mic Mute-LED Mode" enum kcontrol.
Which value does it have now?  If it's "Follow Capture", that's the
correct behavior.  OTOH, if it's "Follow Mute", the LED polarity is
indeed wrong.


thanks,

Takashi


> 
> Cc: <stable@vger.kernel.org>
> Signed-off-by: Hui Wang <hui.wang@canonical.com>
> ---
>  sound/pci/hda/patch_realtek.c | 1 +
>  1 file changed, 1 insertion(+)
> 
> diff --git a/sound/pci/hda/patch_realtek.c b/sound/pci/hda/patch_realtek.c
> index daedcc0adc21..09d93dd88713 100644
> --- a/sound/pci/hda/patch_realtek.c
> +++ b/sound/pci/hda/patch_realtek.c
> @@ -4414,6 +4414,7 @@ static void alc233_fixup_lenovo_line2_mic_hotkey(struct hda_codec *codec,
>  {
>  	struct alc_spec *spec = codec->spec;
>  
> +	spec->micmute_led_polarity = 1;
>  	alc_fixup_hp_gpio_led(codec, action, 0, 0x04);
>  	if (action == HDA_FIXUP_ACT_PRE_PROBE) {
>  		spec->init_amp = ALC_INIT_DEFAULT;
> -- 
> 2.17.1
> 
