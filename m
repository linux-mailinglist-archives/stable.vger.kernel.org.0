Return-Path: <stable-owner@vger.kernel.org>
X-Original-To: lists+stable@lfdr.de
Delivered-To: lists+stable@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id E8E2510B261
	for <lists+stable@lfdr.de>; Wed, 27 Nov 2019 16:25:02 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726858AbfK0PZC (ORCPT <rfc822;lists+stable@lfdr.de>);
        Wed, 27 Nov 2019 10:25:02 -0500
Received: from mx2.suse.de ([195.135.220.15]:36852 "EHLO mx1.suse.de"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1726514AbfK0PZC (ORCPT <rfc822;stable@vger.kernel.org>);
        Wed, 27 Nov 2019 10:25:02 -0500
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
        by mx1.suse.de (Postfix) with ESMTP id 4A26FB0AE;
        Wed, 27 Nov 2019 15:25:00 +0000 (UTC)
Date:   Wed, 27 Nov 2019 16:25:00 +0100
Message-ID: <s5h4kypwddf.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc:     stable@vger.kernel.org
Subject: Re: [PATCH 5.4.y] ALSA: hda - Disable audio component for legacy Nvidia HDMI codecs
In-Reply-To: <20191127151101.GA2752784@kroah.com>
References: <20191127144706.13289-1-tiwai@suse.de>
        <20191127151101.GA2752784@kroah.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Sender: stable-owner@vger.kernel.org
Precedence: bulk
List-ID: <stable.vger.kernel.org>
X-Mailing-List: stable@vger.kernel.org

On Wed, 27 Nov 2019 16:11:01 +0100,
Greg Kroah-Hartman wrote:
> 
> On Wed, Nov 27, 2019 at 03:47:06PM +0100, Takashi Iwai wrote:
> > commit 5a858e79c911330678b5a9be91a24830e94a0dc9 upstream.
> > 
> > The old Nvidia chips have multiple HD-audio codecs on the same
> > HD-audio controller, and this doesn't work as expected with the current
> > audio component binding that is implemented under the one-codec-per-
> > controller assumption; at the probe time, the driver leads to several
> > kernel WARNING messages.
> > 
> > For the proper support, we may change the pin2port and port2pin to
> > traverse the codec list per the given pin number, but this needs more
> > development and testing.
> > 
> > As a quick workaround, instead, this patch drops the binding in the
> > audio side for these legacy chips since the audio component support in
> > nouveau graphics driver is still not merged (hence it's basically
> > unused).
> > 
> > [ Unlike the original subject line, this patch actually disables the
> >   audio component binding for all Nvidia chips on 5.4.y, not only for
> >   legacy chips, but it doesn't matter much; nouveau gfx driver still
> >   doesn't provide the audio component binding, so it's only a
> >   placeholder on 5.4.y -- tiwai ]
> > 
> > BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=205625
> > Fixes: ade49db337a9 ("ALSA: hda/hdmi - Allow audio component for AMD/ATI and Nvidia HDMI")
> > Link: https://lore.kernel.org/r/20191122132000.4460-1-tiwai@suse.de
> > Signed-off-by: Takashi Iwai <tiwai@suse.de>
> > ---
> >  sound/pci/hda/patch_hdmi.c | 2 --
> >  1 file changed, 2 deletions(-)
> > 
> > diff --git a/sound/pci/hda/patch_hdmi.c b/sound/pci/hda/patch_hdmi.c
> > index 78bd2e3722c7..cdacc52a5147 100644
> > --- a/sound/pci/hda/patch_hdmi.c
> > +++ b/sound/pci/hda/patch_hdmi.c
> > @@ -3492,8 +3492,6 @@ static int patch_nvhdmi(struct hda_codec *codec)
> >  
> >  	codec->link_down_at_suspend = 1;
> >  
> > -	generic_acomp_init(codec, &nvhdmi_audio_ops, nvhdmi_port2pin);
> > -
> >  	return 0;
> >  }
> >  
> > -- 
> > 2.16.4
> > 
> 
> This patch adds the build warning:
>   CC [M]  sound/pci/hda/patch_hdmi.o
> sound/pci/hda/patch_hdmi.c:3465:12: warning: ‘nvhdmi_port2pin’ defined but not used [-Wunused-function]
>  3465 | static int nvhdmi_port2pin(struct hda_codec *codec, int port)
>       |            ^~~~~~~~~~~~~~~
>   LD [M]  sound/pci/hda/snd-hda-codec-hdmi.o
> 
> Is that intentional?

No, that's an overlook.

> Did a different patch fix that issue up?

The original commit removes only one of two calls, so these symbols
are still used.  On 5.4.y, there is only one call site and the patch
removes it, so we see now the warning.

OK, please scratch this one, and let me cook and check again for v2.


thanks,

Takashi
